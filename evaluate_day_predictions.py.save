#!/usr/bin/env python3

import json
import pandas as pd
from collections import Counter

LOG_FILE = "day_trade_log.json"
OUTPUT_CSV = "day_prediction_stats.csv"

def evaluate_predictions():
    try:
        with open(LOG_FILE, "r") as f:
            trades = json.load(f)
    except FileNotFoundError:
        print(f"‚ùå {LOG_FILE} not found.")
        return

    eval_data = []

    for trade in trades:
        if trade.get("action") != "SELL":
            continue
        if "prediction" not in trade or "outcome" not in trade:
            continue

        eval_data.append({
            "ticker": trade["ticker"],
            "prediction": trade["prediction"],
            "outcome": trade["outcome"],
            "pnl_pct": trade.get("pnl_pct", 0)
        })

    if not eval_data:
        print("‚ö†Ô∏è No trades with both prediction and outcome found.")
        return

    df = pd.DataFrame(eval_data)
    df.to_csv(OUTPUT_CSV, index=False)

    # ‚úÖ Summary
    print(f"\n‚úÖ Evaluated {len(df)} completed trades with predictions.")

    accuracy = (df["prediction"] == df["outcome"]).mean()
    print(f"üéØ Accuracy: {accuracy:.2%}")

    win_rate = (df["outcome"] == "WIN").mean()
    print(f"üèÜ Win Rate (actual): {win_rate:.2%}")

    pred_win_rate = (df["prediction"] == "WIN").mean()
    print(f"ü§ñ Predicted WIN
